{"ast":null,"code":"import _createForOfIteratorHelper from \"/home/dcestari/Documents/projects/react/react-pokeapi/.yarn/cache/@babel-runtime-npm-7.9.0-fa03662500-3.zip/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport { filter, map, mergeMap, catchError, switchMap } from \"rxjs/operators\";\nimport { actions } from \"./index\";\nimport { of, Observable } from \"rxjs\";\nimport { ApiError } from \"../errors\";\nimport { combineEpics } from \"redux-observable\";\n\nvar getUrlDataByAddress = function getUrlDataByAddress(url) {\n  var urlObj = new URL(url);\n  return {\n    url,\n    size: parseInt(urlObj.searchParams.get(\"limit\"), 10),\n    offset: parseInt(urlObj.searchParams.get(\"offset\"), 10)\n  };\n};\n\nvar getDefaultUrlData = function getDefaultUrlData(offset, size) {\n  return {\n    url: \"https://pokeapi.co/api/v2/pokemon?offset=\".concat(offset, \"&limit=\").concat(size),\n    size,\n    offset\n  };\n};\n\nvar fetchPageEpic = function fetchPageEpic(action$, state$, _ref) {\n  var observableFetch = _ref.observableFetch;\n  return action$.pipe(filter(actions.fetchPage.match), switchMap(function (action) {\n    var urlData = \"url\" in action.payload ? getUrlDataByAddress(action.payload.url) : getDefaultUrlData(action.payload.offset, action.payload.size);\n    return observableFetch(urlData.url).pipe(mergeMap(function (json) {\n      return new Observable(function (subscriber) {\n        subscriber.next(actions.pageFetched({\n          page: json,\n          size: urlData.size,\n          offset: urlData.offset\n        }));\n\n        var _iterator = _createForOfIteratorHelper(json.results),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var result = _step.value;\n            subscriber.next(actions.fetchDetails(result.name));\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      });\n    }), catchError(function (error) {\n      return of(actions.setError(error instanceof ApiError && error.message === \"404\" ? \"Nothing found\" : error.message || error));\n    }));\n  }));\n};\n\nvar fetchPokemonDetailsEpic = function fetchPokemonDetailsEpic(action$, state$, _ref2) {\n  var observableFetch = _ref2.observableFetch;\n  return action$.pipe(filter(actions.fetchDetails.match), mergeMap(function (action) {\n    var url = \"https://pokeapi.co/api/v2/pokemon/\".concat(action.payload.toLowerCase(), \"/\");\n    return observableFetch(url).pipe(map(function (jsonResult) {\n      return actions.detailsFetched({\n        pokemonName: action.payload,\n        data: jsonResult\n      });\n    }), catchError(function (error) {\n      return of(actions.setDetailsError({\n        pokemonName: action.payload,\n        error: error instanceof ApiError && error.message === \"404\" ? \"Nothing found\" : error.message || error\n      }));\n    }));\n  }));\n};\n\nexport default combineEpics(fetchPageEpic, fetchPokemonDetailsEpic);","map":{"version":3,"sources":["/home/dcestari/Documents/projects/react/react-pokeapi/src/redux/pokemonPage/epics.ts"],"names":["filter","map","mergeMap","catchError","switchMap","actions","of","Observable","ApiError","combineEpics","getUrlDataByAddress","url","urlObj","URL","size","parseInt","searchParams","get","offset","getDefaultUrlData","fetchPageEpic","action$","state$","observableFetch","pipe","fetchPage","match","action","urlData","payload","json","subscriber","next","pageFetched","page","results","result","fetchDetails","name","error","setError","message","fetchPokemonDetailsEpic","toLowerCase","jsonResult","detailsFetched","pokemonName","data","setDetailsError"],"mappings":"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","sourcesContent":["import { filter, map, mergeMap, catchError, switchMap } from \"rxjs/operators\";\nimport { INamedApiResourceList, IPokemon } from \"pokeapi-typescript\";\nimport { actions } from \"./index\";\nimport { TypedEpic } from \"../types\";\nimport { of, Observable } from \"rxjs\";\nimport { ApiError } from \"../errors\";\nimport { combineEpics } from \"redux-observable\";\n\nconst getUrlDataByAddress = (url: string) => {\n  const urlObj = new URL(url);\n  return {\n    url,\n    size: parseInt(urlObj.searchParams.get(\"limit\")!, 10),\n    offset: parseInt(urlObj.searchParams.get(\"offset\")!, 10)\n  };\n};\n\nconst getDefaultUrlData = (offset: number, size: number) => ({\n  url: `https://pokeapi.co/api/v2/pokemon?offset=${offset}&limit=${size}`,\n  size,\n  offset\n});\n\nconst fetchPageEpic: TypedEpic = (action$, state$, { observableFetch }) => {\n  return action$.pipe(\n    filter(actions.fetchPage.match),\n    switchMap(action => {\n      const urlData =\n        \"url\" in action.payload\n          ? getUrlDataByAddress(action.payload.url)\n          : getDefaultUrlData(action.payload.offset, action.payload.size);\n\n      return observableFetch<INamedApiResourceList<IPokemon>>(urlData.url).pipe(\n        mergeMap(\n          json =>\n            new Observable<\n              | ReturnType<typeof actions.pageFetched>\n              | ReturnType<typeof actions.fetchDetails>\n            >(subscriber => {\n              subscriber.next(\n                actions.pageFetched({\n                  page: json,\n                  size: urlData.size,\n                  offset: urlData.offset\n                })\n              );\n\n              for (const result of json.results) {\n                subscriber.next(actions.fetchDetails(result.name));\n              }\n            })\n        ),\n        catchError(error =>\n          of(\n            actions.setError(\n              error instanceof ApiError && error.message === \"404\"\n                ? \"Nothing found\"\n                : error.message || error\n            )\n          )\n        )\n      );\n    })\n  );\n};\n\nconst fetchPokemonDetailsEpic: TypedEpic = (action$, state$, { observableFetch }) => {\n  return action$.pipe(\n    filter(actions.fetchDetails.match),\n    mergeMap(action => {\n      const url = `https://pokeapi.co/api/v2/pokemon/${action.payload.toLowerCase()}/`;\n\n      return observableFetch<IPokemon>(url).pipe(\n        map(jsonResult =>\n          actions.detailsFetched({\n            pokemonName: action.payload,\n            data: jsonResult\n          })\n        ),\n        catchError(error =>\n          of(\n            actions.setDetailsError({\n              pokemonName: action.payload,\n              error:\n                error instanceof ApiError && error.message === \"404\"\n                  ? \"Nothing found\"\n                  : error.message || error\n            })\n          )\n        )\n      );\n    })\n  );\n};\n\nexport default combineEpics(fetchPageEpic, fetchPokemonDetailsEpic);\n"]},"metadata":{},"sourceType":"module"}